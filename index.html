<!DOCTYPE html>
<html lang="zh-cn">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  
  <title>社交媒体文案器生成器</title>
</head>

<body>
  <div class="body-area">
    <div class="input">
      小机器人的消息 <br>
      <textarea id="input_bot_msg" style="resize: none;"></textarea><br>
      翻译文本 <br>
      <textarea id="input_translate_msg" style="resize: none;"></textarea><br>

      <button id="button_generate">生成</button>
    </div>
    <div class="output">
      <p>社交媒体文案</p>
      <p id="sns_text" class="output-area">这里是生成的文字...</p>
    </div>
  </div>

</body>

<script type="text/javascript">
  function date_format(date_str) {;
    let date = new Date(date_str);
    
    let year = date.getFullYear();
    let month = date.getMonth() + 1;
    let day = date.getDate();
    let hours = date.getHours();
    let minutes = date.getMinutes();

    let res_str = `${year}-${month}-${day} ${hours}:${minutes}`;

    return res_str;
  }
  function check_input_format(in_str) {
    let msg_str = in_str.match(/\u3010[a-z]+\u3011\n/);
    if (msg_str === null) {
      return false;
    }
    let msg_type = msg_str[0].slice(1, -2);
    if (msg_type == "msg") {
      let date_str = in_str.match(/<\u65f6\u95f4>[0-9]+-[0-9]+-[0-9]+\ [0-9]+:[0-9]+:[0-9]+\n/);
      let type_str = in_str.match(/<\u7c7b\u578b>((\u56fe\u7247)|(\u6587\u672c)|(\u89c6\u9891)|(\u97f3\u9891))\n/);
      if (date_str === null || type_str === null) {
        return false;
      }
      return true;
    } else if (msg_type == "blog") {
      return false;
    }
    return false;
  }
  function gen_sns_text(in_str, text) {
    let msg_type = in_str.match(/\u3010[a-z]+\u3011\n/)[0].slice(1, -2);

    let date_str = in_str.match(/<\u65f6\u95f4>[0-9]+-[0-9]+-[0-9]+\ [0-9]+:[0-9]+:[0-9]+\n/)[0].slice(4, -1);
    let date_format_str = date_format(date_str);

    let footnote = "\u203b\u4ed8\u8d39\u5185\u5bb9\u8bf7\u52ff\u8f6c\u8f7d\u81f3\u5916\u7f51\uff0c\u6709\u9700\u6c42\u8bf7\u81ea\u884c\u8ba2\u9605<br/>\u203b\u7121\u65ad\u8ee2\u8f09\u3001\u518d\u914d\u4fe1\u7b49\u306f\u4e00\u5207\u304a\u65ad\u308a\u3057\u307e\u3059";
    
    text = text.replace(/\n/g, "<br/>")

    if (msg_type == "msg") {
      let res_str = `Message / ${date_format_str}<br/><br/>${text}<br/><br/>${footnote}`;
      return res_str;
    } else if (msg_type == "blog") {
      let res_str = `Blog / ${date_format_str}\n\n`;
      return res_str;
    } else if (msg_type == "twitter") {
      let res_str = `Blog / ${date_format_str}`;
      return res_str;
    }
    return "";
  }
  document.getElementById("button_generate").onclick = function() {
    let bot_msg_str = input_bot_msg.value;
    if (check_input_format(bot_msg_str)) {
      let res = gen_sns_text(bot_msg_str, input_translate_msg.value);
      document.getElementById("sns_text").innerHTML = res;
    } else {
      alert("\u5c0f\u673a\u5668\u4eba\u7684\u6d88\u606f\u683c\u5f0f\u4e0d\u6b63\u786e\u54e6");
    }
  }
</script>

</html>